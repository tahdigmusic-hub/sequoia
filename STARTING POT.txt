<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sequo√Øa ‚Äì Pay via Venmo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body{
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(180deg, #020617, #0f172a);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 28px 16px;
    }

    .container{ width: 100%; max-width: 1040px; }

    /* ---------- TOP BAR ---------- */
    .topbar{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:14px; margin-bottom:16px; flex-wrap:wrap;
    }
    .brand{ min-width:220px; flex:1 1 280px; }
    .brand h1{
      font-size:44px; letter-spacing:-0.03em; font-weight:860;
      line-height:1.05; margin-bottom:6px;
    }
    .sub{ opacity:.82; font-size:14px; line-height:1.35; }

    /* ---------- ADMIN BUTTON ---------- */
    .adminBtn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 14px; border-radius:999px;
      border:1px solid rgba(239,68,68,0.65);
      background:rgba(239,68,68,0.95);
      color:#fff; cursor:pointer; user-select:none; white-space:nowrap;
      max-width:100%; flex:0 0 auto;
      transition:transform .15s ease, opacity .2s ease;
    }
    .adminBtn:active{ transform:scale(0.98); }
    .adminBtn .lockIcon{ font-size:16px; transform:translateY(-0.5px); }
    .adminBtn .btnText{
      font-weight:900; font-size:14px; max-width:220px;
      overflow:hidden; text-overflow:ellipsis;
    }
    .lockPill{
      font-size:11px; opacity:.9; padding:4px 9px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.28);
      background:rgba(255,255,255,0.14);
    }
    @media (max-width:420px){
      .adminBtn{ width:100%; justify-content:space-between; }
      .adminBtn .btnText{ max-width:none; font-size:13px; }
    }

    /* ---------- ADMIN PANEL ---------- */
    .adminPanel{
      display:none; margin:14px 0 18px; padding:14px;
      border-radius:18px; background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      backdrop-filter:blur(8px);
      box-shadow:0 10px 30px rgba(0,0,0,0.22);
    }
    .adminPanelHeader{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom:10px; flex-wrap:wrap;
    }
    .adminTitle{ font-weight:850; font-size:14px; margin-bottom:4px; }
    .adminHint{ font-size:12px; opacity:.75; line-height:1.35; max-width:820px; }

    .toggleRow{
      display:grid; grid-template-columns:1fr auto;
      gap:10px; padding:10px; border-radius:14px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.04);
      margin-top:10px; align-items:center;
    }
    .toggleLabel{ font-size:13px; opacity:.9; line-height:1.3; }
    .switchWrap{ display:inline-flex; align-items:center; gap:10px; font-size:12px; opacity:.85; }
    input[type="checkbox"]{ width:18px; height:18px; accent-color:#3b82f6; cursor:pointer; }

    .adminRight{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    }
    .smallBtn{
      padding:10px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(255,255,255,0.06);
      color:#fff; cursor:pointer; font-size:12px;
      transition:transform .15s ease, background .2s ease;
    }
    .smallBtn:hover{ background:rgba(255,255,255,0.10); }
    .smallBtn:active{ transform:scale(0.98); }

    /* limit/counter UI inside admin */
    .metaLine{
      margin-top:6px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
      font-size:12px;
      opacity:.9;
    }
    .pill{
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(255,255,255,0.06);
      white-space:nowrap;
    }
    .limitInput{
      width:84px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(2,6,23,0.35);
      color:#fff;
      outline:none;
      font-size:12px;
    }
    .limitInput::placeholder{ color:rgba(255,255,255,0.45); }

    /* ---------- CARDS GRID ---------- */
    .grid{ display:grid; grid-template-columns:1fr; gap:14px; margin-top:8px; }
    @media (min-width:760px){ .grid{ grid-template-columns:1fr 1fr 1fr; } }
    @media (min-width:1020px){ .grid{ grid-template-columns:repeat(5, 1fr); } }

    .card{
      position:relative;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:18px;
      padding:16px;
      backdrop-filter:blur(8px);
      box-shadow:0 10px 30px rgba(0,0,0,0.22);
      display:flex; flex-direction:column; gap:10px;
      min-height:320px;
    }
    .price{ font-size:20px; font-weight:900; letter-spacing:-0.02em; line-height:1.15; }
    .desc{ opacity:.92; font-size:13px; line-height:1.35; }
    .divider{ height:1px; background:rgba(255,255,255,0.10); margin:2px 0 6px; }

    /* ---------- PAY BUTTON ---------- */
    .btn{
      position:relative; display:inline-block; width:100%;
      padding:14px; border-radius:999px;
      border:2px solid rgba(59,130,246,1);
      color:#fff; text-decoration:none; text-align:center;
      font-weight:800; letter-spacing:0.01em;
      overflow:hidden; background:transparent; cursor:pointer;
      user-select:none; margin-top:auto;
      transition:transform .15s ease, border-color .2s ease, opacity .2s ease;
    }
    .btn::before{
      content:""; position:absolute; left:0; top:0; height:100%; width:0%;
      background:rgba(59,130,246,1); z-index:-1; transition:width .25s ease;
    }
    .btn:hover::before{ width:100%; }
    .btn:active{ transform:scale(0.98); }
    .btn.green{ border-color:rgba(16,185,129,1); } .btn.green::before{ background:rgba(16,185,129,1); }
    .btn.amber{ border-color:rgba(245,158,11,1); } .btn.amber::before{ background:rgba(245,158,11,1); }
    .btn.purple{ border-color:rgba(168,85,247,1); } .btn.purple::before{ background:rgba(168,85,247,1); }
    .btn.rose{ border-color:rgba(244,63,94,1); } .btn.rose::before{ background:rgba(244,63,94,1); }

    .tiny{ opacity:.65; font-size:12px; margin-top:6px; }

    .optPhoto{
      width:100%; height:140px; object-fit:cover;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.06);
      margin-top:10px;
    }

    /* ---------- SOLD OUT ---------- */
    .soldOut{ opacity:0.55; filter:grayscale(0.35); }
    .soldOut .btn{
      pointer-events:none; cursor:not-allowed;
      border-color:rgba(148,163,184,0.8);
    }
    .soldOut .btn::before{ background:rgba(148,163,184,0.6); }

    .soldOutStamp{
      position:absolute; inset:0; display:none;
      align-items:center; justify-content:center;
      pointer-events:none;
    }
    .soldOut .soldOutStamp{ display:flex; }
    .soldOutStamp span{
      transform:rotate(-18deg);
      font-weight:900; letter-spacing:0.18em; font-size:26px;
      color:rgba(239,68,68,0.50);
      border:3px solid rgba(239,68,68,0.45);
      padding:10px 14px; border-radius:10px;
      text-transform:uppercase;
      background:rgba(15,23,42,0.15);
      box-shadow:0 12px 30px rgba(0,0,0,0.28);
    }

    /* ---------- QR SECTION ---------- */
    .qrWrap{
      margin-top:22px; padding:16px; border-radius:18px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      backdrop-filter:blur(8px);
      box-shadow:0 10px 30px rgba(0,0,0,0.22);
      display:grid; gap:12px; justify-items:center; text-align:center;
    }
    .qrTitle{ font-weight:900; font-size:18px; opacity:.95; }
    .qrSub{ font-size:13px; opacity:.75; line-height:1.35; max-width:760px; }

    .flow{ width:100%; display:grid; grid-template-columns:1fr; gap:10px; margin-top:6px; }
    @media (min-width:760px){ .flow{ grid-template-columns:repeat(5,1fr); } }

    .step{
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.05);
      border-radius:14px; padding:12px 10px;
      min-height:78px;
      display:grid; gap:6px; align-content:center;
    }
    .step .n{ font-weight:900; letter-spacing:0.06em; opacity:.9; font-size:12px; }
    .step .t{ font-size:13px; opacity:.9; line-height:1.25; }

    .qrImg{
      width:min(320px, 90vw);
      height:auto;
      border-radius:16px;
      background:rgba(255,255,255,0.92);
      padding:10px;
    }

    .note{ margin-top:14px; text-align:center; opacity:.7; font-size:13px; line-height:1.35; }

    /* ---------- TOAST ---------- */
    .toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
      z-index:9999; width:min(560px, calc(100vw - 24px));
      background:rgba(2,6,23,0.92);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:16px; padding:12px 14px;
      box-shadow:0 14px 40px rgba(0,0,0,0.45);
      display:none; gap:8px; align-items:flex-start;
    }
    .toast.show{ display:flex; animation:pop 0.18s ease-out; }
    @keyframes pop{
      from { transform:translateX(-50%) translateY(10px); opacity:0; }
      to   { transform:translateX(-50%) translateY(0); opacity:1; }
    }
    .toast .icon{ font-size:18px; margin-top:2px; }
    .toast .msg{ text-align:left; font-size:13px; line-height:1.35; opacity:.95; }
    .toast .close{
      margin-left:auto; border:0; background:transparent;
      color:rgba(255,255,255,0.8); cursor:pointer; font-size:18px;
      line-height:1; padding:2px 6px;
    }

    /* ---------- WELCOME MODAL ---------- */
    .welcomeOverlay{
      position:fixed; inset:0;
      background:rgba(2,6,23,0.55);
      backdrop-filter:blur(6px);
      display:none; align-items:center; justify-content:center;
      z-index:10000; padding:18px;
    }
    .welcomeOverlay.show{ display:flex; }
    .welcomeCard{
      width:min(520px, 92vw);
      background:rgba(15,23,42,0.95);
      border:1px solid rgba(255,255,255,0.14);
      border-radius:22px;
      padding:18px 18px 14px;
      box-shadow:0 18px 60px rgba(0,0,0,0.55);
      text-align:center;
      animation:shakeIn 0.55s ease-out;
    }
    @keyframes shakeIn{
      0%   { transform:scale(0.92) translateY(8px); opacity:0; }
      55%  { transform:scale(1.02) translateY(0); opacity:1; }
      70%  { transform:translateX(-6px); }
      80%  { transform:translateX(6px); }
      90%  { transform:translateX(-3px); }
      100% { transform:translateX(0); }
    }
    .welcomeTitle{ font-weight:900; letter-spacing:-0.02em; font-size:18px; margin-bottom:8px; }
    .welcomeMsg{ opacity:.88; font-size:14px; line-height:1.45; }
    .welcomeBtn{
      margin-top:14px; width:100%;
      padding:12px 14px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(255,255,255,0.08);
      color:#fff; cursor:pointer; font-weight:800;
    }
    .welcomeBtn:active{ transform:scale(0.98); }
  </style>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <h1>üå≤ Sequo√Øa</h1>
        <div class="sub">
          Choose an option and pay Aaron on Venmo.<br />
          Venmo note will be prefilled as: <strong>‚ÄúCamping sequoia‚Äù</strong>
        </div>
      </div>

      <button id="adminBtn" class="adminBtn" type="button" aria-label="Sina backdoor access">
        <span class="lockIcon">üîí</span>
        <span class="btnText">Sina‚Äôs backdoor access</span>
        <span id="lockPill" class="lockPill">Locked</span>
      </button>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="adminPanel" aria-hidden="true">
      <div class="adminPanelHeader">
        <div>
          <div class="adminTitle">Admin Controls</div>
          <div class="adminHint">
            Set an optional <strong>click limit</strong> (auto SOLD OUT when reached). You can still manually mark SOLD OUT anytime.
            Counts + limits are saved in this browser.
          </div>
        </div>
        <div class="adminRight">
          <button id="resetCountsBtn" class="smallBtn" type="button">Reset counts</button>
          <button id="lockBtn" class="smallBtn" type="button">Lock</button>
        </div>
      </div>

      <!-- Party Yurt -->
      <div class="toggleRow">
        <div class="toggleLabel"><strong>$299</strong> ‚Äî Party Yurt</div>
        <label class="switchWrap">Available <input id="toggle299" type="checkbox" /></label>
        <div class="metaLine" style="grid-column: 1 / -1;">
          <span class="pill">Clicks: <strong id="count299">0</strong></span>
          <span class="pill">Limit:</span>
          <input id="limit299" class="limitInput" type="number" min="0" step="1" placeholder="‚àû" />
        </div>
      </div>

      <!-- Lovers Yurt -->
      <div class="toggleRow">
        <div class="toggleLabel"><strong>$449</strong> ‚Äî Lovers Yurt</div>
        <label class="switchWrap">Available <input id="toggle449" type="checkbox" /></label>
        <div class="metaLine" style="grid-column: 1 / -1;">
          <span class="pill">Clicks: <strong id="count449">0</strong></span>
          <span class="pill">Limit:</span>
          <input id="limit449" class="limitInput" type="number" min="0" step="1" placeholder="‚àû" />
        </div>
      </div>

      <!-- Cabins -->
      <div class="toggleRow">
        <div class="toggleLabel"><strong>$499</strong> ‚Äî Cabins</div>
        <label class="switchWrap">Available <input id="toggle499" type="checkbox" /></label>
        <div class="metaLine" style="grid-column: 1 / -1;">
          <span class="pill">Clicks: <strong id="count499">0</strong></span>
          <span class="pill">Limit:</span>
          <input id="limit499" class="limitInput" type="number" min="0" step="1" placeholder="‚àû" />
        </div>
      </div>

      <!-- Friends hut -->
      <div class="toggleRow">
        <div class="toggleLabel"><strong>$349</strong> ‚Äî Friends' hut</div>
        <label class="switchWrap">Available <input id="toggle349a" type="checkbox" /></label>
        <div class="metaLine" style="grid-column: 1 / -1;">
          <span class="pill">Clicks: <strong id="count349a">0</strong></span>
          <span class="pill">Limit:</span>
          <input id="limit349a" class="limitInput" type="number" min="0" step="1" placeholder="‚àû" />
        </div>
      </div>

      <!-- Van lifers -->
      <div class="toggleRow">
        <div class="toggleLabel"><strong>$300</strong> ‚Äî Van lifers</div>
        <label class="switchWrap">Available <input id="toggle300" type="checkbox" /></label>
        <div class="metaLine" style="grid-column: 1 / -1;">
          <span class="pill">Clicks: <strong id="count300">0</strong></span>
          <span class="pill">Limit:</span>
          <input id="limit300" class="limitInput" type="number" min="0" step="1" placeholder="‚àû" />
        </div>
      </div>
    </div>

    <!-- Cards -->
    <div class="grid">
      <!-- 299 Party Yurt -->
      <div id="card299" class="card">
        <div class="soldOutStamp"><span>SOLD OUT</span></div>
        <div class="price">$299: Party Yurt</div>
        <div class="divider"></div>
        <div class="desc">4 people capacity, üõå 1 queen, 2 twin beds</div>

        <a id="pay299" class="btn"
           href="venmo://paycharge?txn=pay&recipients=aaron_levy&amount=299&note=Camping%20sequoia"
        >Pay $299 on Venmo</a>

        <img class="optPhoto" src="yurt4.png" alt="Party Yurt photo (4 people)" />
        <div class="tiny">@aaron_levy</div>
      </div>

      <!-- 449 Lovers Yurt -->
      <div id="card449" class="card">
        <div class="soldOutStamp"><span>SOLD OUT</span></div>
        <div class="price">$449: Lovers Yurt</div>
        <div class="divider"></div>
        <div class="desc">2 people capacity, üõå 1 queen bed</div>

        <a id="pay449" class="btn green"
           href="venmo://paycharge?txn=pay&recipients=aaron_levy&amount=449&note=Camping%20sequoia"
        >Pay $449 on Venmo</a>

        <img class="optPhoto" src="yurt2.png" alt="Lovers Yurt photo (2 people)" />
        <div class="tiny">@aaron_levy</div>
      </div>

      <!-- 499 Cabins -->
      <div id="card499" class="card">
        <div class="soldOutStamp"><span>SOLD OUT</span></div>
        <div class="price">$499: Cabins</div>
        <div class="divider"></div>
        <div class="desc">2 to 8 people per cabin, üõå queen beds</div>

        <a id="pay499" class="btn amber"
           href="venmo://paycharge?txn=pay&recipients=aaron_levy&amount=499&note=Camping%20sequoia"
        >Pay $499 on Venmo</a>

        <img class="optPhoto" src="cabin.png" alt="Cabin photo" />
        <div class="tiny">@aaron_levy</div>
      </div>

      <!-- 349 Friends' hut -->
      <div id="card349a" class="card">
        <div class="soldOutStamp"><span>SOLD OUT</span></div>
        <div class="price">$349: Friends' hut</div>
        <div class="divider"></div>
        <div class="desc">2 people capacity, üõå 2 twin beds</div>

        <a id="pay349a" class="btn purple"
           href="venmo://paycharge?txn=pay&recipients=aaron_levy&amount=349&note=Camping%20sequoia"
        >Pay $349 on Venmo</a>

        <img class="optPhoto" src="bunk.png" alt="Bunk / Friends hut photo" />
        <div class="tiny">@aaron_levy</div>
      </div>

      <!-- 300 Van lifers -->
      <div id="card300" class="card">
        <div class="soldOutStamp"><span>SOLD OUT</span></div>
        <div class="price">$300: Van lifers</div>
        <div class="divider"></div>
        <div class="desc">BYO camper van ‚Äî No hookups</div>

        <a id="pay300" class="btn rose"
           href="venmo://paycharge?txn=pay&recipients=aaron_levy&amount=300&note=Camping%20sequoia"
        >Pay $300 on Venmo</a>

        <img class="optPhoto" src="van.png" alt="Camper van photo" />
        <div class="tiny">@aaron_levy</div>
      </div>
    </div>

    <!-- QR backup -->
    <div class="qrWrap">
      <div class="qrTitle">‚ÄºÔ∏è If Venmo does not open, use the QR code to pay ‚ÄºÔ∏è</div>
      <div class="qrSub">Follow this quick flow (works best on iPhone & Android):</div>

      <div class="flow" aria-label="QR payment steps">
        <div class="step"><div class="n">STEP 1</div><div class="t">Press & hold the QR image üì∑</div></div>
        <div class="step"><div class="n">STEP 2</div><div class="t">Tap ‚ÄúSave to Photos‚Äù ‚úÖ</div></div>
        <div class="step"><div class="n">STEP 3</div><div class="t">Open Venmo üíô</div></div>
        <div class="step"><div class="n">STEP 4</div><div class="t">Tap the Image button üñºÔ∏è</div></div>
        <div class="step"><div class="n">STEP 5</div><div class="t">Select saved QR ‚ûú Pay</div></div>
      </div>

      <img class="qrImg" alt="Venmo QR code for @aaron_levy" src="aaronvenmo.png" />

      <div class="note">
        Don‚Äôt forget: note should say <strong>Camping sequoia</strong> and choose the correct amount.
      </div>
    </div>

    <div class="note">
      Tip: Some in-app browsers (Instagram/TikTok/Facebook) block Venmo app opens ‚Äî QR is the most reliable backup.
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite">
    <div class="icon">üö´</div>
    <div id="toastMsg" class="msg"></div>
    <button class="close" type="button" aria-label="Close" onclick="hideToast()">√ó</button>
  </div>

  <!-- Welcome modal -->
  <div id="welcomeOverlay" class="welcomeOverlay" role="dialog" aria-modal="true">
    <div class="welcomeCard">
      <div class="welcomeTitle">We‚Äôre glad you are here ‚ó°Ãà</div>
      <div class="welcomeMsg">All prices is per person.</div>
      <button class="welcomeBtn" type="button" onclick="closeWelcome()">Let‚Äôs go</button>
    </div>
  </div>

  <script>
    // ----- Welcome modal on load -----
    function closeWelcome(){
      document.getElementById("welcomeOverlay").classList.remove("show");
    }
    window.addEventListener("load", () => {
      document.getElementById("welcomeOverlay").classList.add("show");
    });

    // ----- Toast helpers -----
    let toastTimer = null;
    function showToast(message) {
      const toast = document.getElementById("toast");
      document.getElementById("toastMsg").textContent = message;
      toast.classList.add("show");
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(hideToast, 3800);
    }
    function hideToast() {
      document.getElementById("toast").classList.remove("show");
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = null;
    }

    // ----- Option C fallback: try deep link then web -----
    function venmoFallback(amount) {
      setTimeout(() => {
        window.location.href =
          "https://venmo.com/aaron_levy?txn=pay&amount=" + encodeURIComponent(amount) +
          "&note=" + encodeURIComponent("Camping sequoia");
      }, 800);
    }

    // ----- Admin lock/unlock + availability + counters/limits -----
    const ADMIN_PASSWORD = "Seq123";

    const els = {
      adminBtn: document.getElementById("adminBtn"),
      adminPanel: document.getElementById("adminPanel"),
      lockPill: document.getElementById("lockPill"),
      lockBtn: document.getElementById("lockBtn"),
      resetCountsBtn: document.getElementById("resetCountsBtn"),

      // availability toggles
      toggle299: document.getElementById("toggle299"),
      toggle449: document.getElementById("toggle449"),
      toggle499: document.getElementById("toggle499"),
      toggle349a: document.getElementById("toggle349a"),
      toggle300: document.getElementById("toggle300"),

      // limit inputs
      limit299: document.getElementById("limit299"),
      limit449: document.getElementById("limit449"),
      limit499: document.getElementById("limit499"),
      limit349a: document.getElementById("limit349a"),
      limit300: document.getElementById("limit300"),

      // counts (admin display)
      count299: document.getElementById("count299"),
      count449: document.getElementById("count449"),
      count499: document.getElementById("count499"),
      count349a: document.getElementById("count349a"),
      count300: document.getElementById("count300"),

      // cards
      card299: document.getElementById("card299"),
      card449: document.getElementById("card449"),
      card499: document.getElementById("card499"),
      card349a: document.getElementById("card349a"),
      card300: document.getElementById("card300"),

      // pay links
      pay299: document.getElementById("pay299"),
      pay449: document.getElementById("pay449"),
      pay499: document.getElementById("pay499"),
      pay349a: document.getElementById("pay349a"),
      pay300: document.getElementById("pay300"),
    };

    const STORAGE_KEY = "sequoia_state_v8";
    const LOCK_KEY = "sequoia_admin_unlocked_v8";

    const labels = {
      a299: "$299: Party Yurt",
      a449: "$449: Lovers Yurt",
      a499: "$499: Cabins",
      a349a: "$349: Friends' hut",
      a300: "$300: Van lifers",
    };

    const amounts = { a299: 299, a449: 449, a499: 499, a349a: 349, a300: 300 };

    function defaultState(){
      return {
        // manual availability
        available: { a299:true, a449:true, a499:true, a349a:true, a300:true },
        // click counts
        counts: { a299:0, a449:0, a499:0, a349a:0, a300:0 },
        // optional limits: null = unlimited
        limits: { a299:null, a449:null, a499:null, a349a:null, a300:null }
      };
    }

    function loadState(){
      let state = defaultState();
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) state = { ...state, ...JSON.parse(raw) };
      }catch(e){}

      // hydrate UI
      els.toggle299.checked = !!state.available.a299;
      els.toggle449.checked = !!state.available.a449;
      els.toggle499.checked = !!state.available.a499;
      els.toggle349a.checked = !!state.available.a349a;
      els.toggle300.checked = !!state.available.a300;

      els.count299.textContent = state.counts.a299 ?? 0;
      els.count449.textContent = state.counts.a449 ?? 0;
      els.count499.textContent = state.counts.a499 ?? 0;
      els.count349a.textContent = state.counts.a349a ?? 0;
      els.count300.textContent = state.counts.a300 ?? 0;

      els.limit299.value = state.limits.a299 ?? "";
      els.limit449.value = state.limits.a449 ?? "";
      els.limit499.value = state.limits.a499 ?? "";
      els.limit349a.value = state.limits.a349a ?? "";
      els.limit300.value = state.limits.a300 ?? "";

      // apply auto-sold-out based on limits before rendering
      state = enforceLimits(state, false);
      saveState(state, true);
      applyAvailability(state, false);
      return state;
    }

    function saveState(state, silent=false){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){}
      if (!silent) refreshAdminNumbers(state);
    }

    function refreshAdminNumbers(state){
      els.count299.textContent = state.counts.a299 ?? 0;
      els.count449.textContent = state.counts.a449 ?? 0;
      els.count499.textContent = state.counts.a499 ?? 0;
      els.count349a.textContent = state.counts.a349a ?? 0;
      els.count300.textContent = state.counts.a300 ?? 0;
    }

    function setCardAvailability(cardEl, isAvailable){
      if (isAvailable) cardEl.classList.remove("soldOut");
      else cardEl.classList.add("soldOut");
    }

    function applyAvailability(state, shouldToast){
      handleOne(els.card299, state.available.a299, labels.a299, shouldToast);
      handleOne(els.card449, state.available.a449, labels.a449, shouldToast);
      handleOne(els.card499, state.available.a499, labels.a499, shouldToast);
      handleOne(els.card349a, state.available.a349a, labels.a349a, shouldToast);
      handleOne(els.card300, state.available.a300, labels.a300, shouldToast);

      // attach fallback behavior to all pay links (works only when not sold out)
      els.pay299.onclick = () => { onPayClick("a299"); return true; };
      els.pay449.onclick = () => { onPayClick("a449"); return true; };
      els.pay499.onclick = () => { onPayClick("a499"); return true; };
      els.pay349a.onclick = () => { onPayClick("a349a"); return true; };
      els.pay300.onclick = () => { onPayClick("a300"); return true; };
    }

    function handleOne(cardEl, isAvailable, label, shouldToast){
      const wasSoldOut = cardEl.classList.contains("soldOut");
      setCardAvailability(cardEl, isAvailable);
      if (shouldToast && !isAvailable && !wasSoldOut){
        showToast(`The ${label} option is sold out. Please choose from remaining options.`);
      }
    }

    function enforceLimits(state, shouldToast){
      // if limit is set and count >= limit, force sold out
      for (const key of Object.keys(state.available)){
        const lim = state.limits[key];
        const cnt = state.counts[key] ?? 0;
        if (typeof lim === "number" && lim >= 0 && cnt >= lim){
          if (state.available[key] !== false && shouldToast){
            showToast(`The ${labels[key]} option is sold out. Please choose from remaining options.`);
          }
          state.available[key] = false;
        }
      }
      return state;
    }

    // ----- Pay click handler: increment count, enforce limit, then fallback -----
    let state = null;

    function onPayClick(key){
      // if sold out, block
      if (!state.available[key]){
        showToast(`The ${labels[key]} option is sold out. Please choose from remaining options.`);
        return false;
      }

      // increment click count
      state.counts[key] = (state.counts[key] ?? 0) + 1;

      // update admin numbers immediately
      refreshAdminNumbers(state);

      // enforce limit after increment
      state = enforceLimits(state, true);
      saveState(state, true);
      applyAvailability(state, false);

      // do deep link fallback after click
      venmoFallback(amounts[key]);
      return true;
    }

    // ----- Admin lock/unlock -----
    function setLockedUI(isUnlocked){
      if (isUnlocked){
        els.adminPanel.style.display = "block";
        els.adminPanel.setAttribute("aria-hidden", "false");
        els.lockPill.textContent = "Unlocked";
      }else{
        els.adminPanel.style.display = "none";
        els.adminPanel.setAttribute("aria-hidden", "true");
        els.lockPill.textContent = "Locked";
      }
    }
    function getUnlocked(){ return localStorage.getItem(LOCK_KEY) === "true"; }
    function setUnlocked(val){
      try{ localStorage.setItem(LOCK_KEY, val ? "true" : "false"); }catch(e){}
      setLockedUI(val);
    }

    els.adminBtn.addEventListener("click", () => {
      if (getUnlocked()){
        els.adminPanel.style.display = (els.adminPanel.style.display === "none" ? "block" : "none");
        els.adminPanel.setAttribute("aria-hidden", els.adminPanel.style.display === "none" ? "true" : "false");
        return;
      }
      const pw = prompt("Enter password for Sina‚Äôs backdoor access:");
      if (pw === ADMIN_PASSWORD) setUnlocked(true);
      else if (pw !== null) showToast("Wrong password.");
    });
    els.lockBtn.addEventListener("click", () => setUnlocked(false));

    // ----- Manual availability toggles -----
    function bindAvailabilityToggle(checkboxEl, key){
      checkboxEl.addEventListener("change", () => {
        state.available[key] = checkboxEl.checked;
        state = enforceLimits(state, true); // if already over limit, will force SOLD OUT
        saveState(state);
        applyAvailability(state, false);
      });
    }
    bindAvailabilityToggle(els.toggle299, "a299");
    bindAvailabilityToggle(els.toggle449, "a449");
    bindAvailabilityToggle(els.toggle499, "a499");
    bindAvailabilityToggle(els.toggle349a, "a349a");
    bindAvailabilityToggle(els.toggle300, "a300");

    // ----- Limit inputs -----
    function bindLimitInput(inputEl, key){
      inputEl.addEventListener("input", () => {
        const v = inputEl.value.trim();
        if (v === ""){
          state.limits[key] = null; // unlimited
        }else{
          const n = Number(v);
          state.limits[key] = (Number.isFinite(n) && n >= 0) ? Math.floor(n) : null;
        }
        state = enforceLimits(state, false);
        // sync checkbox if forced sold out
        els["toggle" + key.replace("a","")].checked = !!state.available[key]; // safe for our keys
        saveState(state);
        applyAvailability(state, false);
      });
    }
    bindLimitInput(els.limit299, "a299");
    bindLimitInput(els.limit449, "a449");
    bindLimitInput(els.limit499, "a499");
    bindLimitInput(els.limit349a, "a349a");
    bindLimitInput(els.limit300, "a300");

    // ----- Reset counts button -----
    els.resetCountsBtn.addEventListener("click", () => {
      if (!confirm("Reset click counts for ALL options?")) return;
      for (const k of Object.keys(state.counts)) state.counts[k] = 0;
      // if something was only sold out because of limits, re-enabling is your choice:
      // we do NOT auto-enable. You can toggle on manually.
      saveState(state);
      refreshAdminNumbers(state);
    });

    // ----- Welcome modal -----
    function closeWelcome(){
      document.getElementById("welcomeOverlay").classList.remove("show");
    }
    window.closeWelcome = closeWelcome; // used by button

    window.addEventListener("load", () => {
      document.getElementById("welcomeOverlay").classList.add("show");
    });

    // init
    state = loadState();
    setLockedUI(getUnlocked());

    // also attach venmo fallback to all pay links (in case browser ignores JS)
    document.getElementById("pay299").addEventListener("click", () => venmoFallback(299));
    document.getElementById("pay449").addEventListener("click", () => venmoFallback(449));
    document.getElementById("pay499").addEventListener("click", () => venmoFallback(499));
    document.getElementById("pay349a").addEventListener("click", () => venmoFallback(349));
    document.getElementById("pay300").addEventListener("click", () => venmoFallback(300));
  </script>

  <!-- Welcome modal -->
  <div id="welcomeOverlay" class="welcomeOverlay" role="dialog" aria-modal="true">
    <div class="welcomeCard">
      <div class="welcomeTitle">We‚Äôre glad you are here ‚ó°Ãà</div>
      <div class="welcomeMsg">All prices is per person.</div>
      <button class="welcomeBtn" type="button" onclick="closeWelcome()">Let‚Äôs go</button>
    </div>
  </div>
</body>
</html>
